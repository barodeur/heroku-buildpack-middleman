#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# Work in the build directory
cd $1

# Source in all the profile stuff
for profile in ./.profile.d/*; do
    . ${profile}
done

# Add any vendored Ruby version to the bin
RUBY_VERSION=$(cat $2/buildpack_ruby_version)
if [ ! -z ${RUBY_VERSION} ]; then
    echo "-----> Adding vendored Ruby to PATH: ${RUBY_VERSION}"
    export PATH="./vendor/${RUBY_VERSION}/bin:$PATH"
fi

ls -hal /app/vendor/bundle/ruby/2.0.0/bin

echo
echo

ls -hal ./vendor/ruby-2.0.0/bin

echo
echo

env | sort

# Fix some paths for bundler
export GEM_PATH="./vendor/bundle/ruby/1.9.1"

# Just build the static site
bundle exec middleman build -c
