#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# Work in the build directory
cd $1

# Source in all the profile stuff
for profile in ./.profile.d/*; do
    . ${profile}
done

# Add any vendored Ruby version to the bin
RUBY_VERSION=$(cat ./vendor/heroku/buildpack_ruby_version)
if [ ! -z ${RUBY_VERSION} ]; then
    echo "-----> Adding vendored Ruby to PATH: ${RUBY_VERSION}"
    export PATH="./vendor/${RUBY_VERSION}/bin:$PATH"
fi

find . -maxdepth 5 -type f -exec ls -ld "{}" \;

echo
echo

env | sort

# Fix some paths for bundler
export GEM_PATH="./vendor/bundle/ruby/1.9.1"

# Just build the static site
bundle exec middleman build -c
